properties([pipelineTriggers([githubPush()])])
pipeline {
    agent any; 
    stages {
        stage ('aws_profile_make') {
            environment {
                aws_access_key_id = credentials('aws_access_key_id')
                aws_secret_access_key = credentials('aws_secret_access_key')
                aws_region = credentials('region')
            }
            steps{
                sh ''' 
                aws configure set aws_access_key_id "${aws_access_key_id}" --profile demo
                aws configure set aws_secret_access_key "${aws_secret_access_key}" --profile demo
                aws configure set region "${aws_region}" --profile demo 
                '''
            }
        }
        stage('build_image') {
            steps {
                checkout([
                 $class: 'GitSCM',
                 branches: [[name: 'master']],
                 userRemoteConfigs: [[
                    url: 'git@github.com:musatee/fargate_with_ALB.git',
                    credentialsId: '',
                 ]]
                ])
            }
        }
    }
    post {
        always {
            cleanWs()
        }
    }
}
